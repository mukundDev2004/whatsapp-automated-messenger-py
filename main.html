<!DOCTYPE html >  
<html>  
<head>  
    
    <link rel="stylesheet" href="assets/css/styles.css">
<title>page title</title>  
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f0f0;
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .textarea-container {
        display: flex;
        justify-content: space-between;
    }

    .textarea-container textarea {
        width: calc(50% - 10px); /* Adjust the width as needed */
        height: 300px;
        margin-bottom: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: vertical;
    }

    input[type="number"],
    input[type="button"] {
        padding: 10px;
        margin-bottom: 7px;
        /* margin-right: 10px; */
        border: 1px solid #ccc;
        border-radius: 4px;
        cursor: pointer;
    }

    input[type="number"] {
        margin-left: 37px;
        width: 80px;
    }

    input[type="button"] {
        background-color: #4CAF50;
        color: white;
    }

    input[type="button"]:hover {
        background-color: #45a049;
    }

    button {
        padding: 10px;
        margin-left: 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background-color: #007bff;
        color: #fff;
    }

    button:hover {
        background-color: #0056b3;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.10.8/xlsx.full.min.js"></script>
<!-- <script src="js/main.js"></script> -->
<form enctype="multipart/form-data">
  <input id="upload" type=file name="files[]">
</form>

<script>
var length1;
var compJson;
  var ExcelToJSON = function() {

    this.parseExcel = function(file) {
      var reader = new FileReader();

      reader.onload = function(e) {
        var data = e.target.result;
        var workbook = XLSX.read(data, {
          type: 'binary'
        });
        workbook.SheetNames.forEach(function(sheetName) {
          // Here is your object
          var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
          var json_object = JSON.stringify(XL_row_object);
          compJson = JSON.parse(json_object);
          console.log(compJson[0].Customer);
          jQuery('#xlx_json').val(json_object);
          // jQuery('#xlx_json1').val(json_object);
            length1 = JSON.parse(json_object).length;
            console.log(length1);
            var finalNum = 0;
            for (let i = 0; i < length1; i++) {
                if (!compJson[i].Outstanding || parseInt(compJson[i].Outstanding)< 229) {
                    finalNum++;
                }  
            }
            document.getElementById("length1").innerHTML = length1 - finalNum;
        })
      };

      reader.onerror = function(ex) {
        console.log(ex);
      };

      reader.readAsBinaryString(file);
    };
  };
var need;



  function handleFileSelect(evt) {

    var files = evt.target.files; // FileList object
    var xl2json = new ExcelToJSON();
    xl2json.parseExcel(files[0]);
  }


</script> 
</head>  
<body>  

<textarea class="form-control" rows=35 cols=80 id="xlx_json"></textarea>
<textarea class="form-control" rows=35 cols=80 id="xlx_json1"></textarea>
<textarea class="form-control" rows="35" cols="80" id="xlx_json2" readonly></textarea>
<body><div class="container">
    
    <p>Input customer number</p>
    <div>
        <img src="assets/img/left.jpg" id="left" alt="" style="
        height: 32px;
        position: absolute;
        " onclick="right()">
        <input type="number" id="need" min="0" value=0>
        <img src="assets/img/right.jpg" id="right" alt="" style="
        height: 32px;
        position: absolute;
         " onclick="left()">
    </div>
    <input type="button" value="Generate Message" onclick="generateMessage()">
    <button id="copyButton">Copy Message</button>
    <textarea id="phone" style="border: none;" readonly></textarea>
</div>

    <script>
        function lengthsen() {
            var needValue = document.getElementById("need").value; // Get the value entered in the input
            var customerIndex = parseInt(needValue) - 1; // Adjust for 0-based index
            var customer = compJson[customerIndex]; // Fetch customer details based on the serial number

            var message = "To \n\n" + customer.Customer + "\n\nDear Sir,\n\nGreetings from 'The Auto Alliance'\n\nPlease pay Rs. " + customer.Outstanding + " of your last ledger balance amount.\n\n";

            if (customer.Ageing6)
                message += "91 - 150 days - Rs. " + customer.Ageing6 + "\n\n";
            if (customer.Ageing3)
                message += "61 - 90 days - Rs. " + customer.Ageing3 + "\n\n";
            if (customer.Ageing2)
                message += "31 - 60 days - Rs. " + customer.Ageing2 + "\n\n";
            if (customer.Ageing1)
                message += "00 - 30 days - Rs. " + customer.Ageing1 + "\n\n";

            message += "Bank Details\n\nThe Auto Alliance\nBank of Baroda - Kalwar Road Jaipur\n\nAc. No. : 39940200001033\n\nIFSC code: BARB0KALWAR\n\nOr Via UPI I'd - theautoalliance3069@aubank\nOr via Phone pay, Paytm, gpay, Amazonpay on 7014236242\n\nPlease ignore if already paid\n\nThanks & Regards\nVipin Kumar Arya\n\nMsg Auto generated by Alignbook";

            document.getElementById("xlx_json2").value = message;
            console.log(customer.Phone)
            document.getElementById("phone").innerHTML = customer.Phone;
            for (let i = 0; i < length1; i++) {
              document.getElementById("xlx_json1").innerHTML = document.getElementById("xlx_json1").value + '\n' + "No. " + (i+1) + " = " + compJson[i].Customer + "-" + compJson[i].Outstanding;
            }
        }

        function right(){
            var num = parseInt(document.getElementById('need').value);
            document.getElementById('need').value = num - 1;
            console.log(compJson[num - 2].Outstanding);
            if (!compJson[num - 2].Outstanding || parseInt(compJson[num - 2].Outstanding)< 229) {
                console.log(parseInt(compJson[num - 2].Outstanding))
                right();
            }
            generateMessage();
        }

        function left(){
            var num = parseInt(document.getElementById('need').value);
            document.getElementById('need').value = num + 1;
            console.log(compJson[num].Outstanding);
            if (!compJson[num].Outstanding || parseInt(compJson[num].Outstanding)< 229) {
                console.log("l")
                left();
            }
            generateMessage();
        }


        function generateMessage() {
            // Get the customer number
            var customerNumber = parseInt(document.getElementById('need').value);
            
            // Check if customerNumber is valid
            if (!compJson[customerNumber - 1].Outstanding) {

                return;
            }
            if (customerNumber >= 1 && customerNumber <= compJson.length) {
                // Get the customer data
                var customerData = compJson[customerNumber - 1];
                
                // Set the phone number
                document.getElementById('phone').innerText = customerData.Phone;
                document.getElementById("xlx_json1").innerHTML = "";
                for (let i = 0; i < length1; i++) {
                  document.getElementById("xlx_json1").innerHTML = document.getElementById("xlx_json1").value + '\n' + "No. " + (i+1) + " = " + compJson[i].Customer + "-" + compJson[i].Outstanding;
                }
                // Define the aging criteria ranges
                const agingRanges = [
                    { name: '0 to 30 days', field: 'Ageing1' },
                    { name: '31 to 45 days', field: 'Ageing2' },
                    { name: '46 to 60 days', field: 'Ageing3' },
                    { name: '61 to 90 days', field: 'Ageing4' },
                    { name: '91 to 120 days', field: 'Ageing5' },
                    { name: '121 to 150 days', field: 'Ageing6' },
                    { name: '151 and above', field: 'Ageing7' }

                ];

                // Function to construct the message for a customer based on aging criteria
                function constructMessage(customerData) {
                    let message = `To \n\n${customerData.Customer}\n\nDear Sir,\n\nGreetings from 'The Auto Alliance'\n\n`;

                    // Calculate the total outstanding balance
                    let totalOutstanding = 0;
                    for (let i = 0; i < agingRanges.length; i++) {
                        if (customerData[agingRanges[i].field]) {
                            totalOutstanding += parseInt(customerData[agingRanges[i].field]);
                        }
                    }

                    // Add the total outstanding balance to the message
                    message += `Please pay Rs. ${totalOutstanding.toFixed(2)} of your last ledger balance amount.\n\n`;

                    // Add aging details to the message
                    for (let i = 0; i < agingRanges.length; i++) {
                        if (customerData[agingRanges[i].field] > 0) {
                            message += `${agingRanges[i].name} - Rs. ${customerData[agingRanges[i].field]}\n`;
                        }
                    }

                    // Add bank details and closing message
                    message += `\nBank Details\n\nThe Auto Alliance\nBank of Baroda - Kalwar Road Jaipur\n\nAc. No. : 39940200001033\n\nIFSC code: BARB0KALWAR\n\nOr Via UPI I'd-\ntheautoalliance@barodampay\nOr via Paytm, gpay, Amazonpay on 7014236242\n\nPlease ignore if already paid\n❌❌Our Phone pay is not working❌❌\nPlease use our UPI QR Code or transfer funds directly into the bank.\n\nThanks & Regards\nVipin Kumar Arya\n\nMsg Auto generated by Alignbook`;

                    return message;
                }

                // Generate message for the customer
                var message = constructMessage(customerData);

                // Display the message
                document.getElementById('xlx_json2').value = message;
            } else {
                alert('Please enter a valid customer number.');
            }
// copy phone no. ----------------------------
                var copyText = document.getElementById("phone");
                console.log(copyText.innerText);
                copyText.select();
                copyText.setSelectionRange(0, 99999); /* For mobile devices */
                document.execCommand("copy");
// ------------------------------------------
        }
        $(document).ready(function () {
            $('#copyButton').click(function () {
                var copyText = document.getElementById("xlx_json2");
                copyText.select();
                copyText.setSelectionRange(0, 99999); /* For mobile devices */
                document.execCommand("copy");
            });
        });
        function copyme(){
            var copyText = document.getElementById("length1");
                console.log(copyText.innerText);
                copyText.select();
                copyText.setSelectionRange(0, 99999); /* For mobile devices */
                document.execCommand("copy");
        }
        document.addEventListener('keyup', (event) => {
            // Check if the pressed key is the "Up Arrow" key (key code 38)
            if (event.key === "ArrowUp") {
                // Get the content of the element with id "length1"
                const content = document.getElementById('length1').textContent;

                // Use the Clipboard API to copy the content to the clipboard
                navigator.clipboard.writeText(content)
                    .then(() => {
                        console.log('Content copied to clipboard:', content);
                    })
                    .catch((err) => {
                        console.error('Failed to copy content:', err);
                    });
            }
            // Check if the pressed key is the "Right Arrow" (key code 39)
            if (event.key === "ArrowRight") {
                // Simulate a click on the button with id "right"
                const rightButton = document.getElementById('right');
                if (rightButton) {
                    rightButton.click();
                }
            }

            // Check if the pressed key is the "Left Arrow" (key code 37)
            if (event.key === "ArrowLeft") {
                // Simulate a click on the button with id "left"
                const leftButton = document.getElementById('left');
                if (leftButton) {
                    leftButton.click();
                }
            }
            if (event.key === 'ArrowDown') {
                var copyButton = document.getElementById('copyButton');
                if (copyButton) {
                    copyButton.click(); // Simulate button click
                }
            }
        });
        // Function to detect Space key press and click the button
        document.addEventListener('keydown', function(event) {
            // Check if the pressed key is the Space key
            
        });


    </script>
<textarea id="length1" onclick="copyme()"> </textarea>
<p id="phone"> </p>
<!-- <p>Input customer number</p> -->
<!-- <input type="number" id="need" min="1"> -->
<!-- <input type="button" value="click" onclick="lengthsen()"> -->
<script>
  document.getElementById('upload').addEventListener('change', handleFileSelect, false);
</script>

</body>  
</html>  